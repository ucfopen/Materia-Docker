nginx:
  image: nginx:1.9.0
  ports:
    - "80:80"
    - "8008:8008"
  volumes:
    - "./app/public:/usr/share/www:ro"
    - "./app/static:/usr/share/static:ro"
    - "./config/nginx/sites-enabled:/etc/nginx/conf.d:ro"
  links:
    - "phpfpm:phpfpm"

phpfpm:
  build: ./docker_build/phpfpm
  env_file: ./config/php/env.cfg
  volumes:
    - "./app:/var/www/html:rw"
    - "./config/php:/usr/local/etc/php/conf.d"
    - "./config/deploy_keys/widget_deploy_key:/root/.ssh/id_rsa:ro"
  links:
    - "mysql:mysql"
    - "memcached:memcached"

mysql:
  image: mysql:5.5.44
  env_file: ./config/mysql/env.cfg
  #ports:
  #  - "3306:3306" # uncomment to allow mysql access from the host

memcached:
  image: memcached:1.4.24

# We use a node container to compile js, css, etc
node:
  build: ./docker_build/node
  volumes:
    - "./app:/var/www/html:rw"
    - "./config/deploy_keys/widget_deploy_key:/root/.ssh/id_rsa:ro"
    - "./config/known_hosts:/root/.ssh/known_hosts:ro"
