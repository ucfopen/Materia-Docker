FROM php:5.6.8-fpm
MAINTAINER Ian Turgeon

# System libs needed for php extensions
RUN apt-get update && apt-get install -y \
  git \
  libldap2-dev \
  libmcrypt-dev \
  libmemcached-dev \
  libpng-dev \
  libxml2-dev \
  zlib1g-dev

# Clean up the image
RUN apt-get clean
RUN rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# PHP Exhensions
RUN docker-php-ext-configure ldap --with-libdir=lib/x86_64-linux-gnu
RUN docker-php-ext-install \
	bcmath \
	gd \
	ldap \
	mbstring \
	mcrypt \
	mysql \
	pdo \
	pdo_mysql \
	xml \
	zip

# PECL Libraries
RUN pecl install memcached

# Make sure composer is installed globally
RUN bash -c "curl -sS https://getcomposer.org/installer | php && mv composer.phar /usr/local/bin/composer"

RUN mkdir /root/.ssh/
RUN touch /root/.ssh/known_hosts
RUN ssh-keyscan ***REMOVED*** >> /root/.ssh/known_hosts

# add script that helps us wait for other containers
ADD config/wait-for-it.sh /wait-for-it.sh
RUN chmod +x /wait-for-it.sh

# hack to let php write to the shared disk with boot2docker shares
RUN usermod -u 1000 www-data
